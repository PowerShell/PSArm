variables:
  # Avoid expensive initialization of dotnet cli, see: https://donovanbrown.com/post/Stop-wasting-time-during-NET-Core-builds
  DOTNET_SKIP_FIRST_TIME_EXPERIENCE: 1

stages:

  - template: templates/buildAndTest.yaml

  - stage: Compliance
    dependsOn: Build
    jobs:
      - job: Compliance
        pool:
          vmImage: windows-latest
        steps:
          - template: templates/steps/download.yaml
          - template: templates/steps/compliance.yaml

  - stage: Signing
    dependsOn: Build
    jobs:
      - job: CodeSigning
        displayName: Code Signing
        pool:
          vmImage: windows-latest
        steps:
          - template: templates/steps/download.yaml
          - template: templates/steps/codeSigning.yaml
      - job: CatalogSigning
        dependsOn: CodeSigning
        displayName: Catalog Signing
        pool:
          vmImage: windows-latest
        steps:
          - template: templates/steps/download.yaml
          - template: templates/steps/catalogSigning.yaml

  - stage: Publish
    dependsOn:
      - Tests
      - Compliance
      - Signing
    jobs:
      - job: Publish
        steps:
          - template: templates/steps/download.yaml
          - template: templates/steps/publish.yaml
